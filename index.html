<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Truth or Dare App</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600;700;800&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
            background: linear-gradient(135deg, #E91E63, #9C27B0, #673AB7, #3F51B5);
            background-size: 400% 400%;
            animation: gradientMove 18s ease infinite;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            overflow-x: hidden;
            cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 36 36"><circle cx="18" cy="18" r="18" fill="%23ffc1e3"/><path d="M9 15c0-3 3-6 6-6 1.8 0 3.3.7 4.5 1.8C20.7 9.7 22.2 9 24 9c3 0 6 3 6 6 0 2.2-1 3.9-2.4 5.1 0 3.9-4.2 7.2-9.6 7.2S8.4 24 8.4 20.1C7 18.9 6 17.2 6 15z" fill="%23ff5aa7"/><circle cx="14" cy="16" r="2.2" fill="white"/><circle cx="22" cy="16" r="2.2" fill="white"/><circle cx="14" cy="16" r="1.1" fill="%23222"/><circle cx="22" cy="16" r="1.1" fill="%23222"/><path d="M14 21c1.5 1 3 1 4 1s2.5 0 4-1" stroke="%23ff2e93" stroke-width="2" stroke-linecap="round" fill="none"/></svg>') 18 18, pointer;
        }
        @keyframes gradientMove { 0%{ background-position:0% 50% } 50% { background-position:100% 50% } 100% { background-position:0% 50% } }
        @font-face { font-family: 'Poppins'; font-style: normal; font-weight: 700; src: local('Poppins'); }

        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at 20% 80%, rgba(233, 30, 99, 0.3) 0%, transparent 50%),
                        radial-gradient(circle at 80% 20%, rgba(156, 39, 176, 0.3) 0%, transparent 50%),
                        radial-gradient(circle at 50% 50%, rgba(103, 58, 183, 0.2) 0%, transparent 70%);
            pointer-events: none;
        }

        /* Particle decorations removed (replaced by canvas) */

        .container {
            text-align: center;
            max-width: 450px;
            width: 90%;
            padding: 20px;
            position: relative;
            z-index: 1;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 25px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .title {
            font-size: 3rem;
            font-weight: bold;
            color: white;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 1.2rem;
            color: white;
            opacity: 0.9;
            margin-bottom: 30px;
        }

        .player-info {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
        }

        .current-player {
            font-size: 1.5rem;
            font-weight: bold;
            color: white;
            margin-bottom: 15px;
        }

        .scores { display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; }
        .score-item { display:flex; align-items:center; gap:8px; background: rgba(255,255,255,0.15); padding: 10px 14px; border-radius: 16px; color: white; font-weight: 700; }
        .score-badge { width: 28px; height: 28px; border-radius: 14px; display:flex; align-items:center; justify-content:center; font-size: 0.9rem; background: rgba(0,0,0,0.2); }
        .score-value { display:inline-block; min-width: 16px; transition: transform 0.2s; }

        .buttons {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-bottom: 30px;
        }
        /* Welcome mascot */
        .mascot-wrap { display:flex; justify-content:center; margin: 6px 0 18px; }
        .mascot { width: 180px; height: 180px; filter: drop-shadow(0 10px 24px rgba(0,0,0,.25)); animation: floaty 4s ease-in-out infinite; }
        @keyframes floaty { 0%,100%{ transform: translateY(0) } 50%{ transform: translateY(-8px) } }
        .mascot:hover { animation-duration: 2.6s; }
        /* Enhanced button interactions */
        .choice-button, .bottom-button, .bottle-btn, .util-btn, .difficulty-btn, .edit-player-btn, .add-player-btn { position: relative; overflow: hidden; }
        .click-wave { position: absolute; border-radius: 50%; pointer-events: none; transform: translate(-50%, -50%); animation: wave 600ms ease-out; background: rgba(255,255,255,0.5); width: 10px; height: 10px; left: 0; top: 0; }
        @keyframes wave { from { opacity: .5; transform: translate(-50%,-50%) scale(1); } to { opacity: 0; transform: translate(-50%,-50%) scale(20); } }

        .choice-button {
            width: 100%;
            height: 80px;
            border: none;
            border-radius: 40px;
            font-size: 1.8rem;
            font-weight: 800;
            font-family: 'Poppins', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
            letter-spacing: 0.5px;
            color: white;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        .choice-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.4);
        }

        .choice-button:active {
            transform: translateY(0);
        }

        .truth-button {
            background: linear-gradient(135deg, #ff4d79, #ff7aa5, #ffd1e6);
            position: relative;
            overflow: hidden;
            box-shadow: 0 8px 25px rgba(233, 30, 99, 0.3);
            animation: glowPulse 3s ease-in-out infinite;
        }

        .truth-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.6s ease;
        }

        .truth-button:hover::before {
            left: 100%;
        }

        .truth-button:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 12px 35px rgba(233, 30, 99, 0.4);
        }

        .dare-button {
            background: linear-gradient(135deg, #7c4dff, #b388ff, #e0d7ff);
            position: relative;
            overflow: hidden;
            box-shadow: 0 8px 25px rgba(156, 39, 176, 0.3);
            animation: glowPulse 3s ease-in-out infinite;
        }
        @keyframes glowPulse { 0%,100%{ box-shadow: 0 8px 25px rgba(255,255,255,0.15), 0 0 0px rgba(255,255,255,0.0);} 50%{ box-shadow: 0 12px 35px rgba(255,255,255,0.25), 0 0 20px rgba(255,255,255,0.2);} }

        .dare-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.6s ease;
        }

        .dare-button:hover::before {
            left: 100%;
        }

        .dare-button:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 12px 35px rgba(156, 39, 176, 0.4);
        }

        .bottom-buttons {
            display: flex;
            justify-content: space-around;
            gap: 15px;
        }

        /* Bottle spinner */
        .bottle-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            padding: 12px 20px;
            border-radius: 20px;
            color: white;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.3s ease;
        }
        .bottle-rotate {
            display: inline-block;
            transition: transform 2s cubic-bezier(0.22, 1, 0.36, 1);
        }

        .bottom-button {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            padding: 12px 20px;
            border-radius: 20px;
            color: white;
            font-size: 1rem;
            font-weight: 700;
            font-family: 'Poppins', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
            cursor: pointer;
            transition: background 0.2s;
        }

        .bottom-button:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-1px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        }

        .question-screen {
            display: none;
            text-align: center;
        }

        .question-screen.active {
            display: block;
        }

        .question-box {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            margin: 20px 0;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            perspective: 800px;
        }

        .question-type {
            font-size: 1.5rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
            letter-spacing: 2px;
        }

        .question-text {
            font-size: 1.2rem;
            color: #333;
            line-height: 1.5;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
        }

        .action-button {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            font-size: 1.1rem;
            font-weight: 800;
            font-family: 'Poppins', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
            color: white;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .action-button:hover {
            transform: scale(1.05);
        }

        .complete-button {
            background: linear-gradient(135deg, #00c853, #64dd17);
            box-shadow: 0 6px 20px rgba(233, 30, 99, 0.3);
            transition: all 0.3s ease;
        }

        .complete-button:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 8px 25px rgba(233, 30, 99, 0.4);
        }

        .skip-button {
            background: linear-gradient(135deg, #ff6f00, #ff8f00);
            box-shadow: 0 6px 20px rgba(156, 39, 176, 0.3);
            transition: all 0.3s ease;
        }

        .skip-button:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 8px 25px rgba(156, 39, 176, 0.4);
        }

        /* New Features */
        .timer {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            padding: 10px 20px;
            border-radius: 25px;
            color: white;
            font-weight: bold;
            font-size: 1.2rem;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .sound-toggle {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            padding: 10px;
            border-radius: 50%;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s;
        }

        .sound-toggle:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background: #FFD700;
            animation: confetti-fall 3s linear infinite;
        }

        @keyframes confetti-fall {
            0% {
                transform: translateY(-100vh) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }

        .celebration {
            animation: celebration 0.6s ease-in-out;
        }

        @keyframes celebration {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .question-counter {
            background: rgba(255, 255, 255, 0.2);
            padding: 5px 15px;
            border-radius: 20px;
            color: white;
            font-size: 0.9rem;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .qa-heading {
            color: #fff;
            margin-top: -10px;
            margin-bottom: 6px;
            font-weight: 800;
            letter-spacing: .5px;
            text-transform: uppercase;
            background: linear-gradient(90deg, #ffd1e6, #e0d7ff, #b3e5fc, #ffd1e6);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            animation: hueShift 8s linear infinite;
        }
        @keyframes hueShift { from { filter: hue-rotate(0deg); } to { filter: hue-rotate(360deg); } }

        .difficulty-selector {
            margin: 20px 0;
        }

        .difficulty-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            padding: 8px 16px;
            margin: 0 5px;
            border-radius: 20px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            font-family: 'Poppins', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
            font-weight: 700;
            letter-spacing: 0.3px;
        }

        .difficulty-btn.active {
            background: rgba(255, 255, 255, 0.4);
            transform: scale(1.05);
        }

        .difficulty-btn:hover { background: rgba(255,255,255,0.35); transform: translateY(-1px) scale(1.06); box-shadow: 0 8px 24px rgba(0,0,0,0.2); }
        #easyBtn { background: linear-gradient(135deg, #4caf50AA, #81c784AA); border-color: rgba(76,175,80,.5); }
        #mediumBtn { background: linear-gradient(135deg, #ff9800AA, #ffb74dAA); border-color: rgba(255,152,0,.5); }
        #hardBtn { background: linear-gradient(135deg, #f44336AA, #ef9a9aAA); border-color: rgba(244,67,54,.5); }

        /* Settings Screen Styles */
        .settings-screen {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #E91E63, #9C27B0, #673AB7, #3F51B5);
            z-index: 1000;
            overflow-y: auto;
        }

        .settings-screen.active {
            display: block;
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from {
                transform: translateY(-100%);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .settings-container {
            max-width: 500px;
            margin: 0 auto;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 25px;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            margin-top: 50px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        .settings-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .settings-title {
            font-size: 2.5rem;
            font-weight: bold;
            color: white;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            margin-bottom: 10px;
        }

        .close-settings {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            padding: 10px 15px;
            border-radius: 50%;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .close-settings:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        .player-edit-section {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .player-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px;
            margin-bottom: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            transition: all 0.3s ease;
        }

        .player-item:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateX(5px);
        }

        .player-name {
            color: white;
            font-size: 1.2rem;
            font-weight: 600;
            flex: 1;
        }

        .player-score {
            color: white;
            opacity: 0.8;
            margin-right: 15px;
        }

        .edit-player-btn {
            background: linear-gradient(135deg, #E91E63, #F06292);
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .edit-player-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(233, 30, 99, 0.3);
        }

        .player-input {
            background: rgba(255, 255, 255, 0.9);
            border: none;
            padding: 10px 15px;
            border-radius: 10px;
            font-size: 1rem;
            width: 200px;
            margin-right: 10px;
            transition: all 0.3s ease;
        }

        .player-input:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(233, 30, 99, 0.3);
            transform: scale(1.02);
        }

        .save-btn, .cancel-btn {
            border: none;
            padding: 8px 12px;
            border-radius: 15px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            margin-left: 5px;
        }

        .save-btn {
            background: linear-gradient(135deg, #4CAF50, #66BB6A);
            color: white;
        }

        .cancel-btn {
            background: linear-gradient(135deg, #F44336, #EF5350);
            color: white;
        }

        .save-btn:hover, .cancel-btn:hover {
            transform: scale(1.05);
        }

        .add-player-section {
            text-align: center;
            margin-top: 20px;
        }

        .add-player-btn {
            background: linear-gradient(135deg, #9C27B0, #BA68C8);
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            color: white;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 6px 20px rgba(156, 39, 176, 0.3);
        }

        .add-player-btn:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 8px 25px rgba(156, 39, 176, 0.4);
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @media (max-width: 480px) {
            .title {
                font-size: 2.5rem;
            }
            
            .choice-button {
                height: 70px;
                font-size: 1.5rem;
            }
        }

        /* Professional polish: loader overlay and setup inputs */
        .loader-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.25);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }
        .loader-box {
            background: rgba(255,255,255,0.9);
            padding: 18px 22px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            text-align: center;
            min-width: 220px;
        }
        .loader-row {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-bottom: 8px;
        }
        .dot {
            width: 10px;
            height: 10px;
            border-radius: 5px;
            background: #E91E63;
            animation: bounce 0.9s infinite alternate;
        }
        .dot:nth-child(2) { background: #9C27B0; animation-delay: 0.15s; }
        .dot:nth-child(3) { background: #673AB7; animation-delay: 0.3s; }
        @keyframes bounce {
            from { transform: translateY(0); opacity: 0.8; }
            to { transform: translateY(-8px); opacity: 1; }
        }
        .loader-text { font-weight: 700; color: #333; }

        .setup-row { display:flex; gap:8px; align-items:center; }
        .setup-badge {
            background: rgba(255,255,255,0.25);
            color: white;
            width: 32px; height: 32px; border-radius: 16px;
            display:flex; align-items:center; justify-content:center;
            font-weight: 700;
        }
        .setup-input {
            flex: 1;
            padding: 10px 12px;
            border-radius: 10px;
            border: none; outline: none;
            font-size: 1rem;
            background: rgba(255,255,255,0.95);
            transition: box-shadow 0.2s, transform 0.2s;
        }
        .setup-input:focus {
            box-shadow: 0 0 0 3px rgba(233, 30, 99, 0.25);
            transform: translateY(-1px);
        }

        /* Question utilities */
        .question-utils {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 12px;
        }
        .util-btn {
            background: rgba(0,0,0,0.06);
            border: none;
            padding: 10px 14px;
            border-radius: 16px;
            cursor: pointer;
            font-weight: 600;
            transition: transform 0.2s, background 0.2s;
        }
        .util-btn:hover { transform: translateY(-1px); background: rgba(0,0,0,0.08); }

        /* History modal */
        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); display:none; align-items:center; justify-content:center; z-index: 3000; }
        .modal { width: 90%; max-width: 520px; background: #fff; border-radius: 16px; box-shadow: 0 20px 40px rgba(0,0,0,0.2); overflow: hidden; }
        .modal-header { display:flex; justify-content: space-between; align-items:center; padding: 14px 16px; background: linear-gradient(135deg, #E91E63, #9C27B0); color: #fff; }
        .modal-title { font-weight: 800; }
        .modal-body { max-height: 60vh; overflow:auto; padding: 12px 16px; }
        .history-item { padding: 10px 8px; border-bottom: 1px solid rgba(0,0,0,0.06); display:flex; gap:8px; align-items:center; }
        .history-badge { font-size: 12px; font-weight: 800; color: #fff; padding: 2px 8px; border-radius: 12px; background: #E91E63; }
        .history-badge.dare { background: #9C27B0; }
        .modal-close { background: rgba(255,255,255,0.25); border: none; color:#fff; padding: 8px 12px; border-radius: 10px; cursor: pointer; font-weight: 700; }
    </style>
</head>
<body>
    <canvas id="bgParticles" style="position:fixed;inset:0;z-index:-1;"></canvas>
    <!-- Sound Toggle -->
    <button class="sound-toggle" id="soundToggle" onclick="toggleSound()">🔊</button>
    
    <!-- Timer -->
    <div class="timer" id="timer">⏱️ 0:00</div>

    <div class="container">
        <!-- Landing Screen -->
        <div id="landingScreen">
            <h1 class="title">Truth or Dare</h1>
            <p class="subtitle">Fun party game for everyone</p>
            <div class="mascot-wrap" aria-hidden="true">
                <!-- Inline SVG cartoon mascot -->
                <svg class="mascot" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="Party mascot">
                    <defs>
                        <linearGradient id="g1" x1="0" x2="1" y1="0" y2="1">
                            <stop offset="0%" stop-color="#ff77a9"/>
                            <stop offset="100%" stop-color="#7c4dff"/>
                        </linearGradient>
                    </defs>
                    <g>
                        <ellipse cx="100" cy="120" rx="65" ry="55" fill="url(#g1)"/>
                        <ellipse cx="70" cy="105" rx="10" ry="12" fill="#fff"/>
                        <circle cx="70" cy="108" r="5" fill="#222"/>
                        <ellipse cx="130" cy="105" rx="10" ry="12" fill="#fff"/>
                        <circle cx="130" cy="108" r="5" fill="#222"/>
                        <path d="M75 135 C95 150, 105 150, 125 135" stroke="#fff" stroke-width="6" fill="none" stroke-linecap="round"/>
                        <path d="M45 95 Q55 75 70 70" stroke="#ffbddf" stroke-width="10" stroke-linecap="round"/>
                        <path d="M130 70 Q145 75 155 95" stroke="#d1c0ff" stroke-width="10" stroke-linecap="round"/>
                        <circle cx="52" cy="65" r="6" fill="#ffbddf"/>
                        <circle cx="148" cy="65" r="6" fill="#d1c0ff"/>
                        <circle cx="55" cy="155" r="6" fill="#ffbddf"/>
                        <circle cx="145" cy="155" r="6" fill="#d1c0ff"/>
                    </g>
                </svg>
            </div>
            <div class="buttons">
                <button class="choice-button truth-button" onclick="goToStart()">▶️ Play</button>
                <button class="choice-button dare-button" onclick="openSettings()">⚙️ Settings</button>
            </div>
        </div>

        <!-- Start Setup Screen -->
        <div id="startScreen" style="display:none">
            <h1 class="title">Setup Players</h1>
            <p class="subtitle">Choose number of players and names</p>

            <div style="display:flex;justify-content:center;align-items:center;gap:12px;margin-bottom:16px;">
                <button class="bottom-button" onclick="changePlayerCount(-1)">−</button>
                <div class="question-counter">Players: <span id="playerCountLabel">4</span></div>
                <button class="bottom-button" onclick="changePlayerCount(1)">+</button>
            </div>

            <div id="nameInputs" style="display:flex;flex-direction:column;gap:10px;margin-bottom:20px"></div>

            <div class="bottom-buttons" style="justify-content:center;gap:12px;">
                <button class="bottom-button" onclick="backToLanding()">← Back</button>
                <button class="bottom-button" onclick="startGameFromSetup()">Start Game</button>
            </div>
        </div>

        <!-- Main Game Screen -->
        <div id="mainScreen">
            <h1 class="title">Truth or Dare</h1>
            <p class="subtitle">Choose your challenge!</p>
            
            <!-- Question Counter -->
            <div class="question-counter" id="questionCounter">
                Questions Asked: <span id="questionCount">0</span>
            </div>
            <h3 class="qa-heading">Questions Asked</h3>
            <div style="height:12px;background:rgba(255,255,255,0.25);border-radius:8px;overflow:hidden;margin:10px 0 20px; position:relative;">
                <div id="progressBar" style="height:12px;width:0%;background:linear-gradient(90deg,#ff4d79,#7c4dff);transition:width .45s cubic-bezier(.2,.8,.2,1);"></div>
                <div id="progressGlow" style="position:absolute;top:0;left:0;height:12px;width:0%;background:radial-gradient(circle at right, rgba(255,255,255,0.6), rgba(255,255,255,0));filter: blur(6px);pointer-events:none;"></div>
            </div>
            
            <!-- Difficulty Selector -->
            <div class="difficulty-selector">
                <button class="difficulty-btn active" onclick="setDifficulty('easy')" id="easyBtn">Easy</button>
                <button class="difficulty-btn" onclick="setDifficulty('medium')" id="mediumBtn">Medium</button>
                <button class="difficulty-btn" onclick="setDifficulty('hard')" id="hardBtn">Hard</button>
            </div>
            
            <div class="player-info">
                <div class="current-player" id="currentPlayer">Player 1's Turn</div>
                <div style="display:flex;flex-direction:column;align-items:center;gap:12px;">
                    <canvas id="playerWheel" width="320" height="320" style="background: rgba(255,255,255,0.1); border-radius: 50%; box-shadow: 0 10px 30px rgba(0,0,0,0.15);"></canvas>
                    <div class="scores" id="scores"></div>
                </div>
            </div>

            <div class="buttons">
                <button class="choice-button truth-button" onclick="handleTruth()">✨ TRUTH ✨</button>
                <button class="choice-button dare-button" onclick="handleDare()">🎯 DARE 🎯</button>
            </div>

            <div class="bottom-buttons">
                <button class="bottom-button" onclick="resetGame()">🔄 Reset Game</button>
                <button class="bottom-button" onclick="openSettings()">⚙️ Settings</button>
                <button class="bottom-button" onclick="showStats()">📊 Stats</button>
                <button class="bottle-btn" onclick="spinForPlayer()">🧴 <span id="bottleIcon" class="bottle-rotate">🧭</span> Spin Player</button>
            </div>
        </div>

        <!-- Question Screen -->
        <div id="questionScreen" class="question-screen">
            <h1 class="title">Truth or Dare</h1>
            <div class="current-player pulse" id="questionPlayer">Player 1's Turn</div>
            
            <div class="question-box" id="questionBox">
                <div class="question-type" id="questionType">TRUTH</div>
                <div class="question-text" id="questionText">Loading question...</div>
            </div>

            <div class="action-buttons">
                <button class="action-button complete-button" onclick="completeChallenge()">✓ Completed</button>
                <button class="action-button skip-button" onclick="skipChallenge()">✗ Skip</button>
            </div>

            <div class="question-utils">
                <button class="util-btn" onclick="reRollQuestion()">↻ Re-roll</button>
                <button id="favBtn" class="util-btn" onclick="toggleFavorite()">⭐ Favorite</button>
                <button class="util-btn" onclick="shareQuestion()">🔗 Share</button>
                <select id="countdownSelect" class="util-btn" onchange="setCountdownDuration(this.value)">
                    <option value="0">⏳ Timer: Off</option>
                    <option value="15">⏳ 15s</option>
                    <option value="30">⏳ 30s</option>
                    <option value="60">⏳ 60s</option>
                </select>
                <button id="countdownBtn" class="util-btn" onclick="startCountdown()">▶ Start</button>
            </div>
        </div>
    </div>

    <!-- Loader Overlay -->
    <div id="loader" class="loader-overlay">
        <div class="loader-box">
            <div class="loader-row">
                <div class="dot"></div>
                <div class="dot"></div>
                <div class="dot"></div>
            </div>
            <div id="loaderText" class="loader-text">Loading...</div>
        </div>
    </div>

    <!-- Settings Screen -->
    <div id="settingsScreen" class="settings-screen">
        <button class="close-settings" onclick="closeSettings()">✕</button>
        <div class="settings-container">
            <div class="settings-header">
                <h2 class="settings-title">⚙️ Settings</h2>
            </div>
            
            <div class="player-edit-section">
                <h3 style="color: white; margin-bottom: 20px; text-align: center;">👥 Player Management</h3>
                <div id="playersList">
                    <!-- Players will be dynamically added here -->
                </div>
                <div class="add-player-section">
                    <button class="add-player-btn" onclick="addPlayer()">➕ Add Player</button>
                </div>
            </div>
        </div>
    </div>

    <!-- History Modal -->
    <div id="historyModal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title">🕘 Recent Questions</div>
                <button class="modal-close" onclick="closeHistory()">✕</button>
            </div>
            <div id="historyBody" class="modal-body"></div>
        </div>
    </div>

    <script>
        // Game state
        let currentPlayer = 1;
        let players = ['Player 1', 'Player 2', 'Player 3', 'Player 4'];
        let scores = [0, 0, 0, 0];
        let displayedScores = [0, 0, 0, 0];
        let gameMode = null;
        let currentQuestion = '';
        let questionCount = 0;
        let difficulty = 'easy';
        let soundEnabled = true;
        let timerInterval = null;
        let timeElapsed = 0;
        let gameStats = {
            totalQuestions: 0,
            completedChallenges: 0,
            skippedChallenges: 0,
            averageTime: 0
        };
        let historyList = [];
        let favorites = [];
        let countdownInterval = null;
        let countdownRemaining = 0;
        let particles = [];
        let particleCtx;
        let wheelAngle = 0;

        // Questions database with difficulty levels
        const questions = {
            easy: {
                truth: [
                    "What's your favorite color?",
                    "What's your favorite food?",
                    "What's your favorite movie?",
                    "What's your favorite song?",
                    "What's your favorite season?",
                    "What's your favorite animal?",
                    "What's your favorite hobby?",
                    "What's your favorite place to visit?",
                    "What's your favorite book?",
                    "What's your favorite sport?",
                    "What's your favorite dessert?",
                    "What's your favorite holiday?",
                    "What's your favorite TV show?",
                    "What's your favorite game?",
                    "What's your favorite drink?",
                    "What's your favorite type of weather?",
                    "What's your favorite subject in school?",
                    "What's your favorite type of music?",
                    "What's your favorite way to relax?",
                    "What's your favorite memory from childhood?"
                ],
                dare: [
                    "Do 5 jumping jacks",
                    "Sing 'Happy Birthday' to yourself",
                    "Do a silly dance for 10 seconds",
                    "Make a funny face",
                    "Tell a knock-knock joke",
                    "Do 3 push-ups",
                    "Speak in a funny voice for 30 seconds",
                    "Do 5 squats",
                    "Tell everyone your favorite joke",
                    "Do a cartwheel (or attempt one)",
                    "Do 10 jumping jacks",
                    "Sing a nursery rhyme",
                    "Do a silly walk",
                    "Tell a story about your pet (or imaginary pet)",
                    "Do 5 sit-ups",
                    "Act like a chicken for 15 seconds",
                    "Do 3 burpees",
                    "Tell everyone what you had for breakfast",
                    "Do a handstand (or attempt one)",
                    "Do 10 squats"
                ]
            },
            medium: {
                truth: [
                    "What's the most embarrassing thing you've ever done?",
                    "Who was your first crush?",
                    "What's your biggest fear?",
                    "What's the weirdest dream you've ever had?",
                    "What's something you've never told your parents?",
                    "What's your most embarrassing childhood memory?",
                    "What's the worst lie you've ever told?",
                    "What's something you're secretly proud of?",
                    "What's your biggest pet peeve?",
                    "What's the most childish thing you still do?",
                    "What's something you've always wanted to try but haven't?",
                    "What's your most irrational fear?",
                    "What's the strangest food combination you enjoy?",
                    "What's something you're terrible at but pretend you're good at?",
                    "What's your most embarrassing social media post?",
                    "What's something you do when no one's watching?",
                    "What's the weirdest thing you believed as a child?",
                    "What's your most embarrassing autocorrect fail?",
                    "What's something you're afraid to admit?",
                    "What's the most ridiculous thing you've cried over?"
                ],
                dare: [
                    "Do 20 jumping jacks",
                    "Sing your favorite song out loud",
                    "Do your best impression of a famous person",
                    "Dance for 30 seconds without music",
                    "Tell a joke and make everyone laugh",
                    "Do 10 push-ups",
                    "Speak in an accent for the next 3 rounds",
                    "Do a cartwheel or handstand",
                    "Call someone and sing 'Happy Birthday' to them",
                    "Do your best animal impression",
                    "Do 15 squats",
                    "Tell everyone your most embarrassing story",
                    "Do a silly dance",
                    "Speak only in rhymes for the next 2 rounds",
                    "Do 20 sit-ups",
                    "Act out a movie scene",
                    "Do your best impression of a baby",
                    "Do 10 burpees",
                    "Tell a story using only gestures",
                    "Do your best robot impression"
                ]
            },
            hard: {
                truth: [
                    "What's the most controversial opinion you hold?",
                    "What's the biggest secret you've never told anyone?",
                    "What's the most hurtful thing someone has said to you?",
                    "What's your biggest regret in life?",
                    "What's the most morally questionable thing you've done?",
                    "What's something you've done that you're deeply ashamed of?",
                    "What's the worst thing you've ever said to someone you love?",
                    "What's a belief you hold that most people would disagree with?",
                    "What's the most manipulative thing you've ever done?",
                    "What's something you've done that could have ruined a relationship?",
                    "What's the most selfish thing you've ever done?",
                    "What's a secret about your family that you've never shared?",
                    "What's the most embarrassing thing you've done while drunk?",
                    "What's something you've stolen and never returned?",
                    "What's the worst lie you've told that had serious consequences?",
                    "What's something you've done that you hope no one ever finds out?",
                    "What's the most morally wrong thing you've done for money?",
                    "What's a secret about your past that you're terrified of being discovered?",
                    "What's the most hurtful thing you've done to someone who trusted you?",
                    "What's something you've done that you can never forgive yourself for?"
                ],
                dare: [
                    "Call your ex and tell them you miss them",
                    "Post an embarrassing photo of yourself on social media",
                    "Eat a spoonful of a condiment you hate",
                    "Let someone go through your phone for 2 minutes",
                    "Call a random number and sing 'Happy Birthday'",
                    "Do 50 jumping jacks while singing",
                    "Let someone else post something on your social media",
                    "Eat something off the floor",
                    "Call your parents and tell them you love them (in a funny way)",
                    "Do 30 push-ups",
                    "Let someone else choose your profile picture for a week",
                    "Call a restaurant and order something ridiculous",
                    "Do 50 squats",
                    "Let someone go through your browser history",
                    "Eat a raw ingredient (like an onion or lemon)",
                    "Do 30 burpees",
                    "Let someone else text your best friend from your phone",
                    "Call a random business and ask for the manager",
                    "Do 50 sit-ups",
                    "Let someone else choose what you wear tomorrow"
                ]
            }
        };

        function getRandomQuestion(mode) {
            const questionList = questions[difficulty][mode];
            const randomIndex = Math.floor(Math.random() * questionList.length);
            return questionList[randomIndex];
        }

        function playSound(type) {
            if (!soundEnabled) return;
            
            // Create audio context for sound effects
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            if (type === 'button') {
                oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
                gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.1);
            } else if (type === 'success') {
                oscillator.frequency.setValueAtTime(523, audioContext.currentTime);
                oscillator.frequency.setValueAtTime(659, audioContext.currentTime + 0.1);
                oscillator.frequency.setValueAtTime(784, audioContext.currentTime + 0.2);
                gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.3);
            }
        }

        function createConfetti() {
            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.animationDelay = Math.random() * 3 + 's';
                confetti.style.backgroundColor = ['#FFD700', '#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4'][Math.floor(Math.random() * 5)];
                document.body.appendChild(confetti);
                
                setTimeout(() => {
                    confetti.remove();
                }, 3000);
            }
        }

        function startTimer() {
            timeElapsed = 0;
            timerInterval = setInterval(() => {
                timeElapsed++;
                const minutes = Math.floor(timeElapsed / 60);
                const seconds = timeElapsed % 60;
                document.getElementById('timer').textContent = `⏱️ ${minutes}:${seconds.toString().padStart(2, '0')}`;
            }, 1000);
        }

        function stopTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
        }

        function toggleSound() {
            soundEnabled = !soundEnabled;
            document.getElementById('soundToggle').textContent = soundEnabled ? '🔊' : '🔇';
            playSound('button');
        }

        function setDifficulty(level) {
            difficulty = level;
            document.querySelectorAll('.difficulty-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(level + 'Btn').classList.add('active');
            playSound('button');
        }

        function showStats() {
            const stats = `
                📊 Game Statistics:
                
                Total Questions: ${gameStats.totalQuestions}
                Completed: ${gameStats.completedChallenges}
                Skipped: ${gameStats.skippedChallenges}
                Completion Rate: ${gameStats.totalQuestions > 0 ? Math.round((gameStats.completedChallenges / gameStats.totalQuestions) * 100) : 0}%
                Average Time: ${Math.floor(gameStats.averageTime / 60)}:${(gameStats.averageTime % 60).toString().padStart(2, '0')}
            `;
            alert(stats);
        }

        function updateProgressBar(){
            const max = 50; // arbitrary goal for visual progress
            const pct = Math.min(100, Math.round((questionCount / max) * 100));
            const bar = document.getElementById('progressBar');
            const glow = document.getElementById('progressGlow');
            if (bar) bar.style.width = pct + '%';
            if (glow) glow.style.width = pct + '%';
        }

        function handleTruth() {
            playSound('button');
            showLoader('Picking a juicy truth...');
            setTimeout(() => {
                gameMode = 'truth';
                currentQuestion = getRandomQuestion('truth');
                hideLoader();
                showQuestion();
            }, 500);
        }

        function handleDare() {
            playSound('button');
            showLoader('Finding a spicy dare...');
            setTimeout(() => {
                gameMode = 'dare';
                currentQuestion = getRandomQuestion('dare');
                hideLoader();
                showQuestion();
            }, 500);
        }

        function showQuestion() {
            document.getElementById('mainScreen').style.display = 'none';
            const qs = document.getElementById('questionScreen');
            qs.classList.add('active');
            qs.style.display = 'block';
            
            document.getElementById('questionType').textContent = gameMode.toUpperCase();
            document.getElementById('questionText').textContent = currentQuestion;
            document.getElementById('questionPlayer').textContent = players[currentPlayer - 1] + "'s Turn";
            
            // Start timer and update question count
            startTimer();
            questionCount++;
            gameStats.totalQuestions++;
            document.getElementById('questionCount').textContent = questionCount;
            updateProgressBar();

            // Add to history
            historyList.unshift({ mode: gameMode, text: currentQuestion, player: players[currentPlayer - 1], at: new Date() });
            historyList = historyList.slice(0, 50);
            updateFavState();
        }

        function completeChallenge() {
            stopTimer();
            scores[currentPlayer - 1]++;
            animateScore(currentPlayer - 1, scores[currentPlayer - 1]);
            gameStats.completedChallenges++;
            gameStats.averageTime = (gameStats.averageTime + timeElapsed) / 2;
            
            playSound('success');
            createConfetti();
            
            // Add celebration animation
            document.getElementById('questionBox').classList.add('celebration');
            setTimeout(() => {
                document.getElementById('questionBox').classList.remove('celebration');
            }, 600);
            
            alert(`🎉 ${players[currentPlayer - 1]} completed the challenge! 🎉`);
            nextPlayer();
        }

        function skipChallenge() {
            stopTimer();
            gameStats.skippedChallenges++;
            playSound('button');
            alert(`${players[currentPlayer - 1]} skipped the challenge.`);
            nextPlayer();
        }

        function nextPlayer() {
            stopTimer();
            spinWheelToRandom();
            document.getElementById('mainScreen').style.display = 'block';
            const qs = document.getElementById('questionScreen');
            qs.classList.remove('active');
            qs.style.display = 'none';
            updateCurrentPlayer();
        }

        // Extra interactivity
        function reRollQuestion() {
            if (!gameMode) return;
            currentQuestion = getRandomQuestion(gameMode);
            document.getElementById('questionText').textContent = currentQuestion;
            updateFavState();
        }

        function toggleFavorite() {
            const key = gameMode + '::' + currentQuestion;
            const idx = favorites.indexOf(key);
            if (idx >= 0) favorites.splice(idx, 1); else favorites.push(key);
            updateFavState();
        }

        function updateFavState() {
            const key = gameMode + '::' + currentQuestion;
            const isFav = favorites.includes(key);
            const btn = document.getElementById('favBtn');
            if (btn) btn.textContent = (isFav ? '⭐ Favorited' : '⭐ Favorite');
        }

        function shareQuestion() {
            const text = `${players[currentPlayer - 1]}'s ${gameMode.toUpperCase()}: ${currentQuestion}`;
            if (navigator.share) {
                navigator.share({ title: 'Truth or Dare', text });
            } else {
                navigator.clipboard.writeText(text);
                alert('Copied to clipboard!');
            }
        }

        function openHistory() {
            const body = document.getElementById('historyBody');
            body.innerHTML = '';
            historyList.forEach(item => {
                const div = document.createElement('div');
                div.className = 'history-item';
                const badge = document.createElement('span');
                badge.className = 'history-badge ' + (item.mode === 'dare' ? 'dare' : '');
                badge.textContent = item.mode.toUpperCase();
                const text = document.createElement('div');
                text.textContent = `${item.player}: ${item.text}`;
                div.appendChild(badge);
                div.appendChild(text);
                body.appendChild(div);
            });
            document.getElementById('historyModal').style.display = 'flex';
        }
        function closeHistory() { document.getElementById('historyModal').style.display = 'none'; }

        function spinForPlayer() {
            const bottle = document.getElementById('bottleIcon');
            const spins = 3 + Math.floor(Math.random() * 5);
            const angle = spins * 360 + Math.floor(Math.random() * 360);
            bottle.style.transform = `rotate(${angle}deg)`;
            setTimeout(() => {
                currentPlayer = 1 + Math.floor(Math.random() * players.length);
                updateCurrentPlayer();
            }, 2000);
        }

        // Countdown per-question
        function setCountdownDuration(val) { countdownRemaining = parseInt(val, 10) || 0; }
        function startCountdown() {
            if (countdownInterval) { clearInterval(countdownInterval); countdownInterval = null; }
            if (!countdownRemaining || countdownRemaining <= 0) return;
            let remain = countdownRemaining;
            const btn = document.getElementById('countdownBtn');
            btn.textContent = `⏳ ${remain}s`;
            countdownInterval = setInterval(() => {
                remain--;
                btn.textContent = remain > 0 ? `⏳ ${remain}s` : '⏰ Time!';
                if (remain <= 0) {
                    clearInterval(countdownInterval);
                    countdownInterval = null;
                    alert('⏰ Time is up!');
                }
            }, 1000);
        }

        function updateCurrentPlayer() {
            document.getElementById('currentPlayer').textContent = players[currentPlayer - 1] + "'s Turn";
            document.getElementById('questionPlayer').textContent = players[currentPlayer - 1] + "'s Turn";
        }

        function updateScores() {
            for (let i = 0; i < scores.length; i++) {
                const el = document.getElementById(`score${i + 1}`);
                if (el) el.textContent = scores[i];
            }
        }

        function animateScore(index, target) {
            const el = document.getElementById(`score${index + 1}`);
            if (!el) return updateScores();
            const start = displayedScores[index] || 0;
            const diff = target - start;
            const duration = 500; const startTime = performance.now();
            function step(now){
                const t = Math.min(1, (now - startTime) / duration);
                const val = Math.round(start + diff * (t*t*(3-2*t)));
                el.textContent = val;
                el.style.transform = 'scale(' + (1 + 0.1 * (1 - Math.abs(1 - 2*t))) + ')';
                if (t < 1) requestAnimationFrame(step); else { el.style.transform = 'scale(1)'; displayedScores[index] = target; }
            }
            requestAnimationFrame(step);
        }

        function resetGame() {
            stopTimer();
            currentPlayer = 1;
            scores = [0, 0, 0, 0];
            questionCount = 0;
            timeElapsed = 0;
            gameStats = {
                totalQuestions: 0,
                completedChallenges: 0,
                skippedChallenges: 0,
                averageTime: 0
            };
            updateScores();
            updateCurrentPlayer();
            document.getElementById('mainScreen').style.display = 'block';
            document.getElementById('questionScreen').classList.remove('active');
            document.getElementById('questionCount').textContent = '0';
            document.getElementById('timer').textContent = '⏱️ 0:00';
            playSound('button');
        }

        function openSettings() {
            playSound('button');
            document.getElementById('settingsScreen').classList.add('active');
            updatePlayersList();
        }

        function closeSettings() {
            playSound('button');
            document.getElementById('settingsScreen').classList.remove('active');
        }

        function updatePlayersList() {
            const playersList = document.getElementById('playersList');
            playersList.innerHTML = '';
            
            players.forEach((player, index) => {
                const playerItem = document.createElement('div');
                playerItem.className = 'player-item';
                playerItem.innerHTML = `
                    <span class="player-name">${player}</span>
                    <span class="player-score">Score: ${scores[index]}</span>
                    <button class="edit-player-btn" onclick="editPlayer(${index})">✏️ Edit</button>
                `;
                playersList.appendChild(playerItem);
            });
        }

        function editPlayer(index) {
            const newName = prompt(`Enter new name for ${players[index]}:`, players[index]);
            if (newName && newName.trim() !== '') {
                players[index] = newName.trim();
                updatePlayersList();
                updateCurrentPlayer();
                playSound('success');
            }
        }

        function addPlayer() {
            const newPlayerName = prompt('Enter new player name:');
            if (newPlayerName && newPlayerName.trim() !== '') {
                players.push(newPlayerName.trim());
                scores.push(0);
                updatePlayersList();
                updateScores();
                playSound('success');
            }
        }

        function createFlowers() { /* replaced by particles; left empty intentionally */ }
        function createSparkles() { /* replaced by particles; left empty intentionally */ }

        // Navigation helpers (no framework)
        function showOnly(id) {
            document.getElementById('landingScreen').style.display = id === 'landingScreen' ? 'block' : 'none';
            document.getElementById('startScreen').style.display = id === 'startScreen' ? 'block' : 'none';
            document.getElementById('mainScreen').style.display = id === 'mainScreen' ? 'block' : 'none';
            document.getElementById('questionScreen').style.display = id === 'questionScreen' ? 'block' : 'none';
            if (id !== 'questionScreen') {
                document.getElementById('questionScreen').classList.remove('active');
            }
        }

        function goToStart() {
            showLoader('Setting things up...');
            setTimeout(() => {
                buildNameInputs(players.length);
                showOnly('startScreen');
                hideLoader();
            }, 500);
        }

        function backToLanding() {
            showOnly('landingScreen');
        }

        function startGameFromSetup() {
            const inputs = Array.from(document.querySelectorAll('.setup-name-input'));
            const nextPlayers = inputs.map((el, i) => el.value.trim() || `Player ${i + 1}`);
            players = nextPlayers;
            scores = new Array(players.length).fill(0);
            currentPlayer = 1;
            updateScores();
            updateCurrentPlayer();
            rebuildScoresUI();
            showLoader('Loading game...');
            setTimeout(() => {
                showOnly('mainScreen');
                hideLoader();
            }, 600);
        }

        function changePlayerCount(delta) {
            const min = 2, max = 12;
            const next = Math.max(min, Math.min(max, players.length + delta));
            if (next === players.length) return;
            buildNameInputs(next);
        }

        function buildNameInputs(count) {
            document.getElementById('playerCountLabel').textContent = count;
            const wrap = document.getElementById('nameInputs');
            wrap.innerHTML = '';
            for (let i = 0; i < count; i++) {
                const value = players[i] || `Player ${i + 1}`;
                const row = document.createElement('div');
                row.className = 'setup-row';
                const badge = document.createElement('div');
                badge.className = 'setup-badge';
                badge.textContent = i + 1;
                const input = document.createElement('input');
                input.className = 'setup-name-input setup-input';
                input.value = value;
                input.placeholder = `Player ${i + 1} name`;
                row.appendChild(badge);
                row.appendChild(input);
                wrap.appendChild(row);
            }
        }

        // Loader helpers
        function showLoader(text) {
            const overlay = document.getElementById('loader');
            const label = document.getElementById('loaderText');
            label.textContent = text || 'Loading...';
            overlay.style.display = 'flex';
        }
        function hideLoader() {
            const overlay = document.getElementById('loader');
            overlay.style.display = 'none';
        }

        function rebuildScoresUI() {
            const scoresWrap = document.getElementById('scores');
            scoresWrap.innerHTML = '';
            for (let i = 0; i < players.length; i++) {
                const item = document.createElement('div');
                item.className = 'score-item';
                const badge = document.createElement('div'); badge.className = 'score-badge'; badge.textContent = i + 1;
                const name = document.createElement('div'); name.textContent = players[i] + ':';
                const val = document.createElement('span'); val.id = `score${i + 1}`; val.className = 'score-value'; val.textContent = scores[i] ?? 0;
                item.appendChild(badge); item.appendChild(name); item.appendChild(val);
                scoresWrap.appendChild(item);
            }
            displayedScores = scores.slice();
        }

        // Particle background
        function initParticles(){
            const canvas = document.getElementById('bgParticles');
            const resize=()=>{ canvas.width = window.innerWidth; canvas.height = window.innerHeight; };
            resize(); window.addEventListener('resize', resize);
            particleCtx = canvas.getContext('2d');
            const count = Math.min(420, Math.max(180, Math.floor((canvas.width * canvas.height) / 8000)));
            particles = Array.from({length: count}, ()=>({ x: Math.random()*canvas.width, y: Math.random()*canvas.height, r: 1+Math.random()*2, vx: -0.3+Math.random()*0.6, vy: -0.3+Math.random()*0.6, a: 0.2+Math.random()*0.6 }));
            let mouse = { x: canvas.width/2, y: canvas.height/2, active: false };
            window.addEventListener('mousemove', (e)=>{ mouse.x = e.clientX; mouse.y = e.clientY; mouse.active = true; });
            window.addEventListener('mouseleave', ()=>{ mouse.active = false; });
            function loop(){
                particleCtx.clearRect(0,0,canvas.width,canvas.height);
                for(const p of particles){
                    // mouse interaction (repel)
                    if (mouse.active){
                        const dx = p.x - mouse.x; const dy = p.y - mouse.y; const dist = Math.hypot(dx,dy) || 1;
                        const force = Math.max(0, 80 - dist) / 80; // 0..1
                        p.vx += (dx/dist) * force * 0.2;
                        p.vy += (dy/dist) * force * 0.2;
                    }
                    p.x+=p.vx; p.y+=p.vy;
                    if(p.x<0||p.x>canvas.width) p.vx*=-1; if(p.y<0||p.y>canvas.height) p.vy*=-1;
                    particleCtx.beginPath(); particleCtx.arc(p.x,p.y,p.r,0,Math.PI*2);
                    particleCtx.fillStyle = 'rgba(255,255,255,'+p.a+')'; particleCtx.fill();
                    // gentle friction
                    p.vx *= 0.98; p.vy *= 0.98;
                }
                requestAnimationFrame(loop);
            }
            loop();
        }

        // Wheel drawing and spin
        function drawWheel(){
            const canvas = document.getElementById('playerWheel'); if (!canvas) return;
            const ctx = canvas.getContext('2d'); const cx = canvas.width/2; const cy = canvas.height/2; const radius = Math.min(cx, cy)-10;
            ctx.clearRect(0,0,canvas.width,canvas.height);
            const n = players.length; const arc = 2*Math.PI/n;
            for(let i=0;i<n;i++){
                ctx.beginPath();
                const start = wheelAngle + i*arc; const end = start + arc;
                ctx.moveTo(cx,cy); ctx.arc(cx,cy,radius,start,end);
                ctx.fillStyle = i%2? '#E91E63AA':'#9C27B0AA'; ctx.fill();
                ctx.save(); ctx.translate(cx,cy); ctx.rotate(start+arc/2); ctx.textAlign='right'; ctx.fillStyle='#fff'; ctx.font='bold 14px system-ui'; ctx.fillText(players[i], radius-12, 4); ctx.restore();
            }
            ctx.beginPath(); ctx.moveTo(cx, cy-radius-6); ctx.lineTo(cx-8, cy-radius-24); ctx.lineTo(cx+8, cy-radius-24); ctx.closePath(); ctx.fillStyle='#fff'; ctx.fill();
        }

        function spinWheelToRandom(){
            const n = players.length; const target = Math.floor(Math.random()*n);
            spinWheelToIndex(target);
        }
        function spinWheelToIndex(index){
            const n = players.length; const arc = 2*Math.PI/n; const targetAngle = (Math.PI/2) - (index*arc + arc/2);
            const spins = 4 + Math.floor(Math.random()*3);
            const start = wheelAngle; const end = targetAngle + spins*2*Math.PI; const duration = 2000; const startTime = performance.now();
            function step(now){
                const t = Math.min(1,(now-startTime)/duration); const eased = t*t*(3-2*t);
                wheelAngle = start + (end-start)*eased; drawWheel();
                if(t<1) requestAnimationFrame(step); else { currentPlayer = index+1; updateCurrentPlayer(); playSound('success'); }
            }
            requestAnimationFrame(step);
        }

        // Click wave feedback
        function attachClickWaves(){
            const selectors = ['.choice-button','.bottom-button','.bottle-btn','.util-btn','.difficulty-btn','.edit-player-btn','.add-player-btn'];
            document.querySelectorAll(selectors.join(',')).forEach(btn=>{
                btn.addEventListener('click', (e)=>{
                    const wave = document.createElement('span'); wave.className='click-wave';
                    const rect = btn.getBoundingClientRect(); wave.style.left = (e.clientX-rect.left)+'px'; wave.style.top = (e.clientY-rect.top)+'px';
                    btn.appendChild(wave); setTimeout(()=>wave.remove(), 650);
                });
            });
        }

        // Initialize the app for web-only flow
        showOnly('landingScreen');
        updateScores();
        updateCurrentPlayer();
        createFlowers();
        createSparkles();
        initParticles();
        rebuildScoresUI();
        drawWheel();
        attachClickWaves();
    </script>
</body>
</html>
